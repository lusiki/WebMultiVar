---
title: "MULTIVARIJATNE STATISTIČKE METODE"
author: "dr.sc. Luka Šikić"
date: "Fakultet hrvatskih studija | [Github MV](https://lusiki.github.io/WebMultiVar/)"
# subtitle: "<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>"
subtitle: "Predavanje 6: Klaster analiza"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts] 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(knitr)
opts_chunk$set(
  fig.align="center", #fig.width=6, fig.height=4.5, 
  # out.width="748px", #out.length="520.75px",
  dpi=300, #fig.path='Figs/',
  cache=F#, echo=F, warning=F, message=F
  )
```

```{css, echo = F, eval = T}
@media print {
  .has-continuation {
    display: block !important;
  }
}
remark-slide-content {
  font-size: 22px;
  padding: 20px 80px 20px 80px;
}
.remark-code, .remark-inline-code {
  background: #f0f0f0;
}
.remark-code {
  font-size: 16px;
}
.mid. remark-code { /*Change made here*/
  font-size: 60% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 40% !important;
}
```

```{r paketi, warning=F, echo=F, message=F, eval=TRUE}

library(tidyverse)  # data manipulation and visualization
library(gridExtra)  # plot arrangement
library(ggplot2)
library(tidyverse)
library(dplyr)
```

# Pregled predavanja

<br>
<br>
<br>


1. [Karakteristike klaster analize](#kars)

2. [Udaljenost između opservacija](#slic)

2. [Hijerarhijski klastering](#hier)

3. [K-means klastering](#kmen)


---

class: inverse, center, middle
name: kars

# KLASTER ANALIZA

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

(Općenito)

---

# Što je klaster analiza?


```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klast2.png")
```

--

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klast3.png")
```


--

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klast4.png")
```

--

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klast5.png")
```

---

# Tijek klaster analize
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="650px"}

knitr::include_graphics("../Foto/klasterTok.png")
```

---

class: inverse, center, middle
name: slic

# UDALJENOST IZMEĐU OPSEVACIJA

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

(Podloga za klastering)

---

# Udaljenost vs. sličnost


```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist1.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist2.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist3.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist4.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist5.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist6.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist7.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist8.png")
```

---

# Udaljenost vs. sličnost

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}

knitr::include_graphics("../Foto/klastDist9.png")
```

---

# Više od dvije opservacije

```{r}

three_players <- data.frame(X = c(0,9,-2),
                            Y = c(0,12,19),
                            row.names = c("BLUE", "RED", "GREEN"))

print(three_players)

dist(three_players)
```


---

# Udaljenost između opservacija


```{r}
visinaTezina <- data.frame(Visina = c(6,6,8),
                           Tezina = c(200,202,200),
                           row.names = c(1,2,3))

kable(visinaTezina)
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastVisina.png")
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastVisina1.png")
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastVisina3.png")
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastVisina4.png")
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastVisina5.png")
```

---

# Udaljenost između opservacija
<br>
<br>
<br>
$$
Visina(skalirano) = \frac{visna - (prosječna)Visina}{std(visina)}
$$

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDist10.png")
```

---

# Udaljenost između opservacija

```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDist11.png")
```

---

# Skaliranje 

```{r, message= F, warning=F, fig.height=6}
print(visinaTezina)

scale(visinaTezina)
```

---

# Kategorički podatci

```{r, message= F, warning=F, fig.height=6}
zadovoljstvo <- data.frame(
                      zadovoljstvo = c("Nisko","Nisko","Visoko","Nisko","Srednje"),
                      sreća = c("Ne","Ne","Da","Ne","Ne"))
kable(zadovoljstvo)
```

---

# Jaccardova udaljenost u R

```{r, message= F, warning=F, fig.height=6}
print(zadovoljstvo)

dist(zadovoljstvo, method = "binary") # Udaljenost za kategorije
```

---

# Jaccardova udaljenost u R

.pull-left[
```{r, message= F, warning=F, fig.height=6}
library(dummies)
dummieZadovoljstvo <- dummy.data.frame(zadovoljstvo) # Pretvori u dummie
print(dummieZadovoljstvo)
```
]

.pull-right[
```{r, message= F, warning=F, fig.height=6}
print(zadovoljstvo)
```
]

```{r, message= F, warning=F, fig.height=6}
dist(dummieZadovoljstvo, method = "binary") # Udaljenost za kategorije
```

---

class: inverse, center, middle
name: kars

# HIJERARHIJSKI KLASTERING

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

(...)

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH1.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH2.png")
```


---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH3.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH4.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH5.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH6.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH7.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH8.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH9.png")
```

---

# Grupiranje

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastH10.png")
```

---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ1.png")
```

---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ1.png")
```

---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ2.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ3.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ4.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ5.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ6.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ7.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ8.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ9.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ10.png")
```
---

# Izgled klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastIZ11.png")
```


---

# Klastering procedura

```{r, message= F, warning=F, fig.height=6}
igraci <-  data.frame(X = c(-1,-2,8,7,-12,-15),
                      Y = c(1,-3,6,-8,8,0))
print(igraci)
distIgraci <- dist(igraci, method = "euclidean") # Izračunaj udaljenost
hcIgraci <- hclust(distIgraci, method = 'complete') # Provedi klastering
```

---

# Klastering procedura

```{r, message= F, warning=F, fig.height=6}
klasteri <- cutree(hcIgraci, k = 2) # Odredi broj klastera
print(klasteri)
igraciKlasteri<- mutate(igraci, cluster = klasteri) # Prilagodba
print(igraciKlasteri) # Podatci + klasteri
```
---

# Klastering procedura

```{r, message= F, warning=F, fig.height=5}
ggplot(igraciKlasteri, aes(x = X, y = Y, color = factor(klasteri))) +
  geom_point() +
  ggtitle("Prikaz igrača i klastera u koordinatnom sustavu")
  
```

---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend1.png")
```

---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend2.png")
```

---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend3.png")
```

---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend4.png")
```
---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend5.png")
```
---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend6.png")
```

---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend7.png")
```
---

# Napravi dendogram

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend8.png")
```

---

# Napravi dendogram

```{r, message= F, warning=F, fig.height=4}
plot(hcIgraci)
```

---

# Broj klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend9.png")
```
---

# Broj klastera

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastDend10.png")
```
---

# Broj klastera

```{r, message= F, warning=F, fig.height=6}
library(dendextend)
dendIgraci <- as.dendrogram(hcIgraci)
dendBoje <- color_branches(dendIgraci, h = 2)
plot(dendBoje)
```

---

# Broj klastera

```{r , message= F, warning=F, fig.height=5}
library(dendextend)
dendIgraci <- as.dendrogram(hcIgraci)
dendBoje <- color_branches(dendIgraci, k = 5)
plot(dendBoje)
```

---

# Broj klastera

```{r, message= F, warning=F, fig.height=5}
clusterPripisano <- cutree(hcIgraci, h = 15)
print(clusterPripisano)
igraciKlaster <- mutate(igraci, cluster = clusterPripisano)
print(igraciKlaster)
```


---

class: inverse, center, middle
name: kars

# K MEANS KLASTERING

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

(Općenito)

---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK1.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK2.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK3.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK4.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK5.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK6.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK7.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK8.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK9.png")
```
---

# Intuicija

<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK10.png")
```

---

# Provedi kmeans()

```{r, message= F, warning=F, fig.height=6}

lineup <- data.frame(X =c(-1,-2,8,7,-12,-15,-13,15,21,12,-25,26),
           Y = c(1,-3,6,-8,8,0,-10,16,2,-15,1,0))
head(print(lineup),6) 

model <- kmeans(lineup, centers = 2)
```


---

# Provedi kmeans()

```{r, message= F, warning=F, fig.height=6}
print(model$cluster)
```
```{r, message= F, warning=F, fig.height=6}
lineupKlasteri <- mutate(lineup, cluster = model$cluster)
head(print(lineupKlasteri),6)
```

--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK10.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK11.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK12.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK13.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK14.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastK15.png")
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, message= F, warning=F, fig.height=6}
model <- kmeans(x = lineup, centers = 2) # Provedi model sa dva klastera
model$tot.withinss # Kvaliteta modela
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, message= F, warning=F, fig.height=6}
library(purrr)
tot_withinss <- map_dbl(1:10, function(k){
model <- kmeans(x = lineup, centers = k)
model$tot.withinss
})
elbow_df <- data.frame(
k = 1:10,
tot_withinss = tot_withinss
)
head(print(elbow_df),5)
```
--- 

# Odredi broj klastera
<br>
<br>
```{r, message= F, warning=F, fig.height=4}
ggplot(elbow_df, aes(x = k, y = tot_withinss)) +
geom_line() +
scale_x_continuous(breaks = 1:10)
```
--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS1.png")
```

--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS2.png")
```

--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS3.png")
```
--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS4.png")
```
--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS5.png")
```

--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS6.png")
```

--- 

# Silhouette analiza
<br>
<br>
<br>
<br>
```{r, include=TRUE, fig.align="center", echo=FALSE, out.width="500px"}
knitr::include_graphics("../Foto/klastS7.png")
```
--- 

# Silhouette analiza

```{r, message= F, warning=F, fig.height=5}
library(cluster)
pam_k3 <- pam(lineup, k = 3)
pam_k3$silinfo$widths
```
--- 

# Silhouette analiza

```{r, message= F, warning=F, fig.height=4}
sil_plot <- silhouette(pam_k3)
plot(sil_plot)
```
--- 

# Silhouette analiza

```{r, message= F, warning=F, fig.height=5}
pam_k3$silinfo$avg.width

#  1: Dobro klastersko poklapanje
#  0: Granično poklapanje između klastera
# -1: Loše poklapanje
```
--- 

# Silhouette analiza

```{r, message= F, warning=F, fig.height=5}
sil_width <- map_dbl(2:10, function(k){
model <- pam(x = lineup, k = k)
model$silinfo$avg.width
})
sil_df <- data.frame(
k = 2:10,
sil_width = sil_width
)
head(print(sil_df),5)
```

--- 

# Silhouette analiza

```{r, message= F, warning=F, fig.height=5}
ggplot(sil_df, aes(x = k, y = sil_width)) +
geom_line() +
scale_x_continuous(breaks = 2:10)
```













































